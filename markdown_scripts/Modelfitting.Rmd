---
title: "Model fitting script for meta-analysis"
author: "Justin Tiano"
date: "01/08/2022"
output: html_document
---

# INTRODUCTION

This script is used to run statistics on the meta-analyis effect size data. First data is loaded and certain variables are combined (example: shallow mud + deep mud ==> mud) for the analysis. TOC and Chl-a summmary effect sizes are calculated and retrieved with the 'getdats' function. Significant categorical variables for trawling and TOC or Chl-a are assessed individually for subgroup analysis (plotted on a separate script). Significant continuous variables are assessed individually and plotted. In the final section, stepwise statistical model selection is carried out for the short term response to trawling (within 5 days) as well as the comprehensive dataset (assessing potential biogeochemical recovery). 

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(metafor)
```

Input functions for plots and calculations
 - shows edits to the original effect size dataframe (df) which includes combining certain categories, and fixing details for individual studies  
```{r}
load("../r_objects/Exp-Obs.rda")

# Edit names
names(df)[c(9:10,14:15,37,44,47,48,49,51,11,38,40,39,3,52,46,45,50)] = c("hhabtype","hseason","watdepth","slicedepth","timetrawldays",
                                                                   "cvel", "phosbot", "salbot", "silbot", "nppsurf", "gear", 
                                                                   "heffort", "effortGFW", "heffortunits", "stype", "shoredist",
                                                                   "nitbot","O2bot","tempbot")
df = df[,c(1,3,7,9:16,37:52,61:82)] # reduce number of columns

# Fixing data: combining categories

## Seasonality 
df$hseason[df$hseason=="Tropical dry season"] = "winter"
df$hseason[df$hseason=="Tropical wet season"] = "summer"
df$hseason[df$hseason=="Temperate winter"] = "winter"
df$hseason[df$hseason=="Temperate summer"] = "summer"
df$hseason[df$hseason=="Temperate spring"] = "spring"
df$hseason[df$hseason=="Temperate autumn"] = "autumn"

## Depth slices
df$slicedepth[df$slicedepth=="0-0.5"] = "0-1"
df$slicedepth[df$slicedepth=="0-5.5"] = "0-5"
df$slicedepth[df$slicedepth=="Grab sample"] = "0-5"
df$slicedepth[df$slicedepth=="Full core"] = "0-5"
df$slicedepth[df$slicedepth=="surface sediment"] = "0-1"
df$slicedepth[df$slicedepth=="0-2"] = "0-2.5"
df$slicedepth[df$slicedepth=="0-5"] = "0-5+"
df$slicedepth[df$slicedepth=="0-10"] = "0-5+"

## Habitat
df$hhabtype[df$hhabtype=="Deep mud"] = "Shallow mud"
df$hhabtype[df$hhabtype=="Shallow sandy mud"] = "Shallow mud"
df$hhabtype[df$hhabtype=="Shallow silty sand"] = "Shallow sand"
df$hhabtype[df$hhabtype=="Shallow silt"] = "Shallow mud"
df$hhabtype[df$hhabtype=="Shallow sand"] = "Sand"
df$hhabtype[df$hhabtype=="Shallow mud"] = "Mud"

# Editing individual studies

## Seasons
df$hseason[40:44] = "summer"   # Ferguson et al. Location=Brisbane, has intermediate seasons in the southern hemisphere
df$hseason[45:54] = "autumn"   # Ferguson et al. Location=Brisbane, has intermediate seasons in the southern hemisphere
df$hseason[236:239] = "spring" # Lui et al. Location=Hong Kong, has intermediate seasons

## Days since trawling
df$timetrawldays[df$article_id==19] = 1      #  Rajesh et al 2019
df$timetrawldays[df$article_id==96] = 1      #  Lui et al 2011
df$timetrawldays[df$article_id==100] = 1     #  Bhagirathan U. et al 2010 
df$timetrawldays[df$article_id==184] = 1     #  Mayer et al 1991
df$timetrawldays[305:311] = 1                #  Brown et al 2005 experimental data 
df$timetrawldays[527] = 0.003472222          #  Missing data Falcao et al 2003 
df$timetrawldays[df$article_id==0] = 0.03125 #  Tiano et al 2022 Set to 45 minutes after trawling 

## Unknown date since last trawled
df$timetrawldays[df$article_id==20] =  "unknown"  # Paradis et al 2019
df$timetrawldays[df$article_id==69] =  "unknown"  # Martin et al 2014
df$timetrawldays[df$article_id==70] =  "unknown"  # Palanques et al 2014
df$timetrawldays[df$article_id==71] =  "unknown"  # Pusceddu et al 2014
df$timetrawldays[298:304] =            "unknown"  # Brown et al 2005 observational data 
df$timetrawldays[df$article_id==33] =  "unknown"  # Van de Velde et al 2018
df$timetrawldays[df$article_id==111] = "unknown"  # Sanchez et al 2009
df$timetrawldays[df$article_id==115] = "unknown"  # Simboura et al 2008

# Other edits
df = df[-c(659:670),]  # remove 1cm sediment samples from Tiano et al 2022 as 1-10 cm used for analysis
df = df[-c(640:642),]  # remove original averaged data from Brylinsky et al 1994 (different [more] data from study used)
df = df[-c(365:519,527:539,541:551),]  # remove unused data from Polymenakou et al 2005 and Falcao et al 2003

# Datasets for short and long term trawling effects
df1 = subset(df, df$timetrawldays<= 1 & df$timetrawldays>= 0 )         # select immediate trawling
df1$timetrawldays = as.numeric(df1$timetrawldays) 
df2 = subset(df, df$timetrawldays != "unknown" )                       # first take out unknown for recovery models
df2 = subset(df2, df2$timetrawldays>= 0 )                              # trawling + recovery for all known trawling times
df2$timetrawldays = as.numeric(df2$timetrawldays) 
All = subset(df, df$timetrawldays>= 0 | df$timetrawldays == "unknown") # Comprehensive dataset 
UN = subset(df,timetrawldays=="unknown")                               # Dataset where time since last trawled is not known

# Datasets for TOC and Chl-a used in meta-regressions 
OC = subset(df1,df1$Response.variable=="TOC")
OCrec = subset(df2,Response.variable=="TOC")
OCAll = subset(All,Response.variable=="TOC")
OCUN  = subset(UN,Response.variable=="TOC")
CH = subset(df1,Response.variable=="Chl-a")
CHrec = subset(df2,Response.variable=="Chl-a")
CHAll = subset(All,Response.variable=="Chl-a")
CHUN = subset(UN,Response.variable=="Chl-a")

details = df[,c(1:6,8:12,28)] # to view dataframe with details for all observations

save(details,OC,OCrec,OCAll,OCUN,CH,CHrec,CHAll,CHUN,df,df1,df2,All,UN, file = "../r_objects/meta.dat3.rda")
```

Retrieve data (to skip above steps)
```{r, warning=FALSE}
load("../r_objects/meta.dat3.rda")
```

# EVALUATING INDIVIDUAL VARIABLES

 - Simple meta-regressions are run for categorical and continuous variables to assess their stand alone effects and potential inclusion into the final predictive models (see FULL MODEL SELECTION below). 

## Categorical variables (TOC and Chl-a)

Models for significant nominal variables (also used in subgroup analysis) for
  1) Dataset with immediate trawl effects, 
  2) Dataset with trawling + recovery, 
  3) Dataset with all the data (unknown time since trawling included).

 - Significant results and R2 shown for each factor (NS = not significant, *** p < 0.001, ** p < 0.01, * p < 0.05, . p < 0.1)
 - Remove intercept (example: slicedepth-1) to view results for all levels
 - Run model with intercept to view R-squared values

###1) Immediate trawling effect (figure in main text)
 - OC Sample depth:    QM(df = 3) = 8.8583, p-val = 0.0312; R2=19.85%
 - OC Habitat:         QM(df = 2) = 3.5831, p-val = 0.1667; R2=10.41% 
 - OC Season:          QM(df = 4) = 5.1130, p-val = 0.2759; R2=7.66%
 - Chl-a Sample depth: QM(df = 3) = 12.6087, p-val = 0.0056, R2=5.11%
 - Chl-a Habitat:      QM(df = 2) = 9.3657, p-val = 0.0093; R2=0.00%   
 - Chl-a Season:       QM(df = 4) = 15.0687, p-val = 0.0046; R2=1.04%

```{r, warning = F}
# TOC
OCdep <- rma.uni(data=OC, yi=lnRR, vi=VarLnRR, method = "REML",mods=~(slicedepth), weighted=TRUE)# *0-1; R2=19.85%
OCsed <- rma.uni(data=OC, yi=lnRR, vi=VarLnRR, method = "REML", mods=~(hhabtype), weighted=TRUE) # NS; R2=10.41% 
OCsea <- rma.uni(data=OC, yi=lnRR, vi=VarLnRR, method = "REML",mods=~(hseason), weighted=TRUE)   # NS; R2=7.66%

# Chl-a
CHdep <- rma.uni(data=CH, yi=lnRR, vi=VarLnRR, method = "REML",mods=~(slicedepth), weighted=TRUE)# ***0-1; R2=5.11%
CHsed <- rma.uni(data=CH, yi=lnRR, vi=VarLnRR, method = "REML",mods=~(hhabtype), weighted=TRUE)  # *Sand; R2=0.00%    
CHsea <- rma.uni(data=CH, yi=lnRR, vi=VarLnRR, method = "REML",mods=~(hseason), weighted=TRUE)   # NS; R2=1.04%
```

###2) Trawling and recovery (still need to do)
 - OC Sample depth:    QM(df = 2) = 34.6892, p-val < .0001; R2=59.63%
 - OC Habitat:         QM(df = 1) = 0.7433, p-val = 0.3886; R2=0.00% 
 - OC Season:          QM(df = 4) = 5.2002, p-val = 0.2674; R2=0.00%
 - Chl-a Sample depth: QM(df = 2) = 8.7977, p-val = 0.0123; R2=7.91%
 - Chl-a Habitat:      QM(df = 1) = 15.0946, p-val = 0.0001; R2=18.73%   
 - Chl-a Season:       QM(df = 3) = 14.8680, p-val = 0.0019; R2=18.58%
```{r, warning = F}
# TOC
OCdep <- rma.uni(data=OCrec, yi=lnRR, vi=VarLnRR, method = "REML",mods=~(slicedepth), weighted=TRUE) #***0-1; R2=59.63%
OCsed <- rma.uni(data=OCrec, yi=lnRR, vi=VarLnRR, method = "REML",mods=~(hhabtype), weighted=TRUE)   # ***Mud,**Sand; R2=0.00% 
OCsea <- rma.uni(data=OCrec, yi=lnRR, vi=VarLnRR, method = "REML",mods=~(hseason), weighted=TRUE)    # ***winter,** autumn; R2=0.00%

# Chl-a
CHdep <- rma.uni(data=CHrec, yi=lnRR, vi=VarLnRR, method = "REML",mods=~(slicedepth), weighted=TRUE) # ***0-1; R2=7.91%
CHsed <- rma.uni(data=CHrec, yi=lnRR, vi=VarLnRR, method = "REML",mods=~(hhabtype), weighted=TRUE)   # ***Mud,**Sand; R2=18.73%    
CHsea <- rma.uni(data=CHrec, yi=lnRR, vi=VarLnRR, method = "REML",mods=~(hseason), weighted=TRUE)    # *** for autumn summer and winter; R2=18.58%
```

###3) Comprehensive data (figure in supplement)
 - OC Sample depth:    QM(df = 2) = 18.0886, p-val = 0.0001; R2=26.33%
 - OC Habitat:         QM(df = 1) = 0.0128, p-val = 0.9098; R2=0.00% 
 - OC Season:          QM(df = 4) = 5.6196, p-val = 0.2294; R2=0.00%
 - Chl-a Sample depth: QM(df = 2) = 7.8794, p-val = 0.0195; R2=6.75%
 - Chl-a Habitat:      QM(df = 1) = 15.7478, p-val < .0001; R2=19.17%   
 - Chl-a Season:       QM(df = 3) = 15.3432, p-val = 0.0015; R2=18.84%
```{r, warning = F}
# TOC
OCdep <- rma.uni(data=OCAll, yi=lnRR, vi=VarLnRR, method = "REML",mods=~(slicedepth), weighted=TRUE) # ***0-1,*0-5; R2=26.33%
OCsed <- rma.uni(data=OCAll, yi=lnRR, vi=VarLnRR, method = "REML",mods=~(hhabtype), weighted=TRUE)   # ***Mud,**Sand; R2=0.00% 
OCsea <- rma.uni(data=OCAll, yi=lnRR, vi=VarLnRR, method = "REML",mods=~(hseason), weighted=TRUE)    # ***winter,*** autumn; R2=0.00%

# Chl-a
CHdep <- rma.uni(data=CHAll, yi=lnRR, vi=VarLnRR,method = "REML", mods=~(slicedepth), weighted=TRUE) # ***0-1; R2=6.75%
CHsed <- rma.uni(data=CHAll, yi=lnRR, vi=VarLnRR, method = "REML",mods=~(hhabtype), weighted=TRUE)   # ***Mud,**Sand; R2=19.17%    
CHsea <- rma.uni(data=CHAll, yi=lnRR, vi=VarLnRR, method = "REML",mods=~(hseason), weighted=TRUE)    # *** for autumn summer and winter; R2=18.84%
```

## Continuous variables

Simple meta-regressions for continuous variables: 
  1) Dataset with immediate trawl effects, 
  2) Dataset with trawling + recovery, 
  3) Dataset with all the data (unknown time since trawling included). 
  The natural log is taken for the variables if it improves the model AIC.
  
 - Significant results and R2 shown for each factor (NS = not significant, *** p < 0.001, ** p < 0.01, * p < 0.05, . p < 0.1)

### Total Organic Carbon (OC)

####1) TOC Immediate trawling effect
 - After visual inspection and analysis of p-values R2, and theoretical consideration (would it make sense in the real world).
      - log(cvel), log(silbot) and log(nitbot) seem the most promising.
      - salbot is collinear with log(silbot) and is affected by stronger effects in the Mediterranean studies (bias).
 
```{r, fig.width =8, fig.height = 8, warning=FALSE}
# Current Velocity 
M1 <- rma.uni(data=OC, yi=lnRR, vi=VarLnRR, method = "REML",mods=~(cvel), weighted=TRUE)       # NS R2 = 0%, 
M1log <- rma.uni(data=OC, yi=lnRR, vi=VarLnRR, method = "REML",mods=~log(cvel), weighted=TRUE) # NS R2 = 0%
AIC.rma(M1,M1log) # log slightly better (no-log=8.718314, log=8.674069)

# Bottom Silica
M2 <- rma.uni(data=OC, yi=lnRR, vi=VarLnRR, method = "REML",mods=~(silbot), weighted=TRUE)       # NS R2 = 0%
M2log <- rma.uni(data=OC, yi=lnRR, vi=VarLnRR, method = "REML",mods=~log(silbot), weighted=TRUE) # NS R2 = 0%
AIC.rma(M2,M2log) # no-log better (no-log=6.989999, log=7.598355)

# Bottom Salinity
M3 <- rma.uni(data=OC, yi=lnRR, vi=VarLnRR, method = "REML",mods=~(salbot), weighted=TRUE)       # NS R2 = 0.00%
M3log <- rma.uni(data=OC, yi=lnRR, vi=VarLnRR, method = "REML",mods=~log(salbot), weighted=TRUE) # NS R2 = 0.00%
AIC.rma(M3,M3log) # log slightly better (no-log=8.148450	, log=8.103692)

# Water Depth
M4 <- rma.uni(data=OC, yi=lnRR, vi=VarLnRR, method = "REML",mods=~(watdepth), weighted=TRUE)       # NS R2 = 0%
M4log <- rma.uni(data=OC, yi=lnRR, vi=VarLnRR, method="REML", mods=~log(watdepth), weighted=TRUE)  # . R2 = 4.64%
AIC.rma(M4,M4log) # log better (no-log=10.166053, log=-0.6319024	)

# Time since trawling (not used for immediate trawling)
#M5 <- rma.uni(data=OC, yi=lnRR, vi=VarLnRR, method="REML", mods=~(timetrawldays), weighted=TRUE)          # NS R2 = 0%
#M5log <- rma.uni(data=OC, yi=lnRR, vi=VarLnRR, method="REML", mods=~log(timetrawldays+1), weighted=TRUE)  # NS R2 = 0%
#AIC.rma(M5,M5log) # log slightly better (no-log=10.52668, log=10.45339)

# Distance from shore
M6 <- rma.uni(data=OC, yi=lnRR, vi=VarLnRR, method="REML", mods=~(shoredist), weighted=TRUE)          # NS R2 = 5.04%
M6log <- rma.uni(data=OC, yi=lnRR, vi=VarLnRR, method="REML", mods=~log(shoredist+1), weighted=TRUE)  # *** R2 = 41.40%
AIC.rma(M6,M6log) # log better (no-log=6.8860956, log=-1.196694)

# Net primary production
M7 <- rma.uni(data=OC, yi=lnRR, vi=VarLnRR, method="REML", mods=~(nppsurf), weighted=TRUE)        # NS R2 = 0%
M7log <- rma.uni(data=OC, yi=lnRR, vi=VarLnRR, method="REML", mods=~log(nppsurf), weighted=TRUE)  # NS R2 = 0%
AIC.rma(M7,M7log) # log slightly better (no-log=7.688688, log=7.740720)

# Bottom Phosphorus
M8 <- rma.uni(data=OC, yi=lnRR, vi=VarLnRR, method="REML", mods=~(phosbot), weighted=TRUE)        # NS R2 = 0%
M8log <- rma.uni(data=OC, yi=lnRR, vi=VarLnRR, method="REML", mods=~log(phosbot), weighted=TRUE)  # NS  R2 = 0%
AIC.rma(M8,M8log) # log slightly better (no-log=8.669528, log=8.020653)

# Bottom Nitrate
M9 <- rma.uni(data=OC, yi=lnRR, vi=VarLnRR, method="REML", mods=~(nitbot), weighted=TRUE)        # NS R2 = 0%
M9log <- rma.uni(data=OC, yi=lnRR, vi=VarLnRR, method="REML", mods=~log(nitbot), weighted=TRUE)  # NS R2 = 0%
AIC.rma(M9,M9log) # log better (no-log=7.742789, log=8.176273)

# Bottom O2
M10 <- rma.uni(data=OC, yi=lnRR, vi=VarLnRR, method="REML", mods=~(O2bot), weighted=TRUE)        # NS R2 = 0%
M10log <- rma.uni(data=OC, yi=lnRR, vi=VarLnRR, method="REML", mods=~log(O2bot), weighted=TRUE)  # NS R2 = 0%
AIC.rma(M10,M10log) # no-log slightly better (no-log=8.777568, log=8.776936)

# Bottom Temperature
M11 <- rma.uni(data=OC, yi=lnRR, vi=VarLnRR, method="REML", mods=~(tempbot), weighted=TRUE)        # NS R2 = 0%
M11log <- rma.uni(data=OC, yi=lnRR, vi=VarLnRR, method="REML", mods=~log(tempbot), weighted=TRUE)  # NS R2 = 0%
AIC.rma(M11,M11log) # no-log better (no-log=8.777568, log=8.776936)

# Visualize data
par(mfrow = c(3,3))
regplot(M1log, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0)
regplot(M2, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0)
regplot(M3log, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0)
regplot(M4, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0)
#regplot(M5log, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0)
regplot(M6log, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0)
regplot(M7log, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0)
regplot(M8log, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0)
regplot(M9log, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0)
regplot(M10, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0)
regplot(M11, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0)
```

####2) TOC Trawling and recovery 
 - After visual inspection, analysis of p-values and R2 values and theoretical consideration (would it make sense in the real world)
      - log(cvel), log(silbot) seem the most promising. Interactions with timetrawldays can be investigated for recovery effect.
 
```{r, fig.width =8, fig.height = 8, warning=FALSE}
# Current Velocity 
M1 <- rma.uni(data=OCrec, yi=lnRR, vi=VarLnRR, method="REML", mods=~(cvel), weighted=TRUE)       # *** R2 = 20.61%, 
M1log <- rma.uni(data=OCrec, yi=lnRR, vi=VarLnRR, method="REML", mods=~log(cvel), weighted=TRUE) # *** R2 = 32.83%
AIC.rma(M1,M1log) # log better (no-log=20.37480, log=14.17538)

# Bottom Silica
M2 <- rma.uni(data=OCrec, yi=lnRR, vi=VarLnRR, method="REML", mods=~(silbot), weighted=TRUE)       # *** R2 = 22.40%
M2log <- rma.uni(data=OCrec, yi=lnRR, vi=VarLnRR, method="REML", mods=~log(silbot), weighted=TRUE) # ** R2 = 22.33%
AIC.rma(M2,M2log) # log slightly better (no-log=21.11871, log=20.40702)

# Bottom Salinity
M3 <- rma.uni(data=OCrec, yi=lnRR, vi=VarLnRR, method="REML", mods=~(salbot), weighted=TRUE)       # *** R2 = 20.58%
M3log <- rma.uni(data=OCrec, yi=lnRR, vi=VarLnRR, method="REML", mods=~log(salbot), weighted=TRUE) # ** R2 = 18.92%
AIC.rma(M3,M3log) # no-log slightly better (no-log=24.02914, log=24.73210)

# Water Depth
M4 <- rma.uni(data=OCrec, yi=lnRR, vi=VarLnRR, method="REML", mods=~(watdepth), weighted=TRUE)       # NS R2 = 0.00%
M4log <- rma.uni(data=OCrec, yi=lnRR, vi=VarLnRR, method="REML", mods=~log(watdepth), weighted=TRUE) # NS R2 = 0.00%
AIC.rma(M4,M4log) # no-log better (no-log=29.20571, log=31.03953)

# Time since trawling
M5 <- rma.uni(data=OCrec, yi=lnRR, vi=VarLnRR, method="REML", mods=~(timetrawldays), weighted=TRUE)          # NS R2 = 0.76%
M5log <- rma.uni(data=OCrec, yi=lnRR, vi=VarLnRR, method="REML", mods=~log(timetrawldays+1), weighted=TRUE)  # NS R2 = 0.00%
AIC.rma(M5,M5log) # no-log better (no-log=30.43435, log=31.79520)

# Distance from shore
M6 <- rma.uni(data=OCrec, yi=lnRR, vi=VarLnRR, method="REML", mods=~(shoredist), weighted=TRUE)          # NS R2 = 0.00%
M6log <- rma.uni(data=OCrec, yi=lnRR, vi=VarLnRR, method="REML", mods=~log(shoredist+1), weighted=TRUE)  # NS R2 = 0.00%
AIC.rma(M6,M6log) # log better (no-log=31.99310, log=25.84963)

# Net primary production
M7 <- rma.uni(data=OCrec, yi=lnRR, vi=VarLnRR, method="REML", mods=~(nppsurf), weighted=TRUE)        # NS R2 = 0.00%
M7log <- rma.uni(data=OCrec, yi=lnRR, vi=VarLnRR, method="REML", mods=~log(nppsurf), weighted=TRUE)  # NS R2 = 19.74%
AIC.rma(M7,M7log) # log slightly better (no-log=32.20478, log=31.95208)

# Bottom Phosphorus
M8 <- rma.uni(data=OCrec, yi=lnRR, vi=VarLnRR, method="REML", mods=~(phosbot), weighted=TRUE)        # . R2 = 0.00%
M8log <- rma.uni(data=OCrec, yi=lnRR, vi=VarLnRR, method="REML", mods=~log(phosbot), weighted=TRUE)  # ** R2 = 2.16%
AIC.rma(M8,M8log) # log better (no-log=29.03282, log=25.40457)

# Bottom Nitrate
M9 <- rma.uni(data=OCrec, yi=lnRR, vi=VarLnRR, method="REML", mods=~(nitbot), weighted=TRUE)        # NS R2 = 1.70%
M9log <- rma.uni(data=OCrec, yi=lnRR, vi=VarLnRR, method="REML", mods=~log(nitbot), weighted=TRUE)  # * R2 = 3.98%
AIC.rma(M9,M9log) # log better (no-log=30.09318, log=27.30483)

# Bottom O2
M10 <- rma.uni(data=OCrec, yi=lnRR, vi=VarLnRR, method="REML", mods=~(O2bot), weighted=TRUE)        # NS R2 = 0%
M10log <- rma.uni(data=OCrec, yi=lnRR, vi=VarLnRR, method="REML", mods=~log(O2bot), weighted=TRUE)  # NS R2 = 0%
AIC.rma(M10,M10log) # no-log slightly better (no-log=8.777568, log=8.776936)

# Bottom Temperature
M11 <- rma.uni(data=OCrec, yi=lnRR, vi=VarLnRR, method="REML", mods=~(Tempbot), weighted=TRUE)        # NS R2 = 0%
M11log <- rma.uni(data=OCrec, yi=lnRR, vi=VarLnRR, method="REML", mods=~log(Tempbot), weighted=TRUE)  # NS R2 = 0%
AIC.rma(M11,M11log) # no-log better (no-log=8.777568, log=8.776936)

# Visualize data
par(mfrow = c(3,3))
regplot(M1log, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0)
regplot(M2log, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0)
regplot(M3, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0)
regplot(M4, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0)
regplot(M5log, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0)
regplot(M6log, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0)
regplot(M7, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0)
regplot(M8log, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0)
regplot(M9, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0)
regplot(M10, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0)
regplot(M11, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0)
```

####3) TOC Comprehensive data 
 - After visual inspection, analysis of p-values and R2 values and theoretical consideration (would it make sense in the real world)
      - log(cvel), log(silbot) seem the most promising.
 
```{r, fig.width =8, fig.height = 8, warning=FALSE}
# Current Velocity 
M1 <- rma.uni(data=OCAll, yi=lnRR, vi=VarLnRR, method="REML", mods=~(cvel), weighted=TRUE)       # . R2 = 0.80%, 
M1log <- rma.uni(data=OCAll, yi=lnRR, vi=VarLnRR, method="REML", mods=~log(cvel), weighted=TRUE) # NS R2 = 1.42%
AIC.rma(M1,M1log) # log better (no-log=35.78164, log=34.77451)

# Bottom Silica
M2 <- rma.uni(data=OCAll, yi=lnRR, vi=VarLnRR, method="REML", mods=~(silbot), weighted=TRUE)       # *** R2 = 23.42%
M2log <- rma.uni(data=OCAll, yi=lnRR, vi=VarLnRR, method="REML", mods=~log(silbot), weighted=TRUE) # *** R2 = 24.90%
AIC.rma(M2,M2log) # log better (no-log=39.83752, log=37.12110)

# Bottom Salinity
M3 <- rma.uni(data=OCAll, yi=lnRR, vi=VarLnRR, method="REML", mods=~(salbot), weighted=TRUE)       # NS R2 = 0.00%
M3log <- rma.uni(data=OCAll, yi=lnRR, vi=VarLnRR, method="REML", mods=~log(salbot), weighted=TRUE) # ** R2 = 0.00%
AIC.rma(M3,M3log) # no-log slightly better (no-log=54.97400, log=55.14679)

# Water Depth
M4 <- rma.uni(data=OCAll, yi=lnRR, vi=VarLnRR, method="REML", mods=~(watdepth), weighted=TRUE)       # NS R2 = 0.98%
M4log <- rma.uni(data=OCAll, yi=lnRR, vi=VarLnRR, method="REML", mods=~log(watdepth), weighted=TRUE) # NS R2 = 0.00%
AIC.rma(M4,M4log) # no-log slightly better (no-log=56.09875, log=56.97134)

# Time since trawling (cannot be used with non-numeric 'unknown' trawl time studies)
#M5 <- rma.uni(data=OCAll, yi=lnRR, vi=VarLnRR, method="REML", mods=~(timetrawldays), weighted=TRUE)        # NS R2 = 0.00%
#M5log <- rma.uni(data=OCAll, yi=lnRR, vi=VarLnRR, method="REML", mods=~log(timetrawldays), weighted=TRUE)  # error
#AIC.rma(M5,M5log) # use M5 for visualization

# Distance from shore
M6 <- rma.uni(data=OCAll, yi=lnRR, vi=VarLnRR, method="REML", mods=~(shoredist), weighted=TRUE)          # NS R2 = 0.00%
M6log <- rma.uni(data=OCAll, yi=lnRR, vi=VarLnRR, method="REML", mods=~log(shoredist+1), weighted=TRUE)  # NS R2 = 1.14%
AIC.rma(M6,M6log) # log slightly better (no-log=56.30674, log=56.03964)

# Net primary production
M7 <- rma.uni(data=OCAll, yi=lnRR, vi=VarLnRR, method="REML", mods=~(nppsurf), weighted=TRUE)        # NS R2 = 5.57%
M7log <- rma.uni(data=OCAll, yi=lnRR, vi=VarLnRR, method="REML", mods=~log(nppsurf), weighted=TRUE)  # NS R2 = 0%
AIC.rma(M7,M7log) # log slightly better (no-log=57.39743, log=56.13714)

# Bottom Phosphorus
M8 <- rma.uni(data=OCAll, yi=lnRR, vi=VarLnRR, method="REML", mods=~(phosbot), weighted=TRUE)        # NS R2 = 0.00%
M8log <- rma.uni(data=OCAll, yi=lnRR, vi=VarLnRR, method="REML", mods=~log(phosbot), weighted=TRUE)  # NS  R2 = 0.00%
AIC.rma(M8,M8log) # no-log slightly better (no-log=57.12822, log=57.77370)

# Bottom Nitrate
M9 <- rma.uni(data=OCAll, yi=lnRR, vi=VarLnRR, method="REML", mods=~(nitbot), weighted=TRUE)        # NS R2 = 0.00%
M9log <- rma.uni(data=OCAll, yi=lnRR, vi=VarLnRR, method="REML", mods=~log(nitbot), weighted=TRUE)  # NS R2 = 0.00%
AIC.rma(M9,M9log) # no-log slightly better (no-log=56.50734, log=56.68182)

# Bottom O2
M10 <- rma.uni(data=OCAll, yi=lnRR, vi=VarLnRR, method="REML", mods=~(O2bot), weighted=TRUE)        # NS R2 = 0%
M10log <- rma.uni(data=OCAll, yi=lnRR, vi=VarLnRR, method="REML", mods=~log(O2bot), weighted=TRUE)  # NS R2 = 0%
AIC.rma(M10,M10log) # no-log slightly better (no-log=8.777568, log=8.776936)

# Bottom Temperature
M11 <- rma.uni(data=OCAll, yi=lnRR, vi=VarLnRR, method="REML", mods=~(Tempbot), weighted=TRUE)        # NS R2 = 0%
M11log <- rma.uni(data=OCAll, yi=lnRR, vi=VarLnRR, method="REML", mods=~log(Tempbot), weighted=TRUE)  # NS R2 = 0%
AIC.rma(M11,M11log) # no-log better (no-log=8.777568, log=8.776936)

# Visualize data
par(mfrow = c(3,3))
regplot(M1log, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0)
regplot(M2log, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0)
regplot(M3, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0)
regplot(M4log, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0)
#regplot(M5, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0) # error
regplot(M6log, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0)
regplot(M7, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0)
regplot(M8, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0)
regplot(M9, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0)
regplot(M10, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0)
regplot(M11, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0)
```

### Sediment Chlorophyll-a (Chl-a)

####1) Chl-a Immediate trawling effect
 - After visual inspection and analysis of p-values R2, and theoretical consideration (would it make sense in the real world).
      - log(cvel), log(silbot), watdepth, log(nppsurf) seem the most promising. 
 
```{r, fig.width =8, fig.height = 8, warning=FALSE}
# Current Velocity
M1 <- rma.uni(data=CH, yi=lnRR, vi=VarLnRR, method="REML", mods=~(cvel), weighted=TRUE)       # ** R2 = 21.37%, 
M1log <- rma.uni(data=CH, yi=lnRR, vi=VarLnRR, method="REML", mods=~log(cvel), weighted=TRUE) # *** R2 = 34.51%
AIC.rma(M1,M1log) # log better (no-log=93.94504, log=88.20386)

# Bottom Silica
M2 <- rma.uni(data=CH, yi=lnRR, vi=VarLnRR, method="REML", mods=~(silbot), weighted=TRUE)       # * R2 = 4.65%
M2log <- rma.uni(data=CH, yi=lnRR, vi=VarLnRR, method="REML", mods=~log(silbot), weighted=TRUE) # *** R2 = 22.56%
AIC.rma(M2,M2log) # log better (no-log=99.91666, log=91.00182)

# Bottom Salinity
M3 <- rma.uni(data=CH, yi=lnRR, vi=VarLnRR, method="REML", mods=~(salbot), weighted=TRUE)       # NS R2 = 0.88%
M3log <- rma.uni(data=CH, yi=lnRR, vi=VarLnRR, method="REML", mods=~log(salbot), weighted=TRUE) # NS R2 = 0%
AIC.rma(M3,M3log) # no-log slightly better (no-log=101.8665	, log=102.8462)

# Water Depth
M4 <- rma.uni(data=CH, yi=lnRR, vi=VarLnRR, method="REML", mods=~(watdepth), weighted=TRUE)       # *** R2 = 23.58%
M4log <- rma.uni(data=CH, yi=lnRR, vi=VarLnRR, method="REML", mods=~log(watdepth), weighted=TRUE) # . R2 = 4.79%
AIC.rma(M4,M4log) # no-log better (no-log=94.46211, log=103.80846)

# Time since trawling (for immediate trawling this is between 0-1 days)
M5 <- rma.uni(data=CH, yi=lnRR, vi=VarLnRR, method="REML", mods=~(timetrawldays), weighted=TRUE)          # *** R2 = 38.81%
M5log <- rma.uni(data=CH, yi=lnRR, vi=VarLnRR, method="REML", mods=~log(timetrawldays+1), weighted=TRUE)  # *** R2 = 39.65%
AIC.rma(M5,M5log) # log better (no-log=87.20995, log=86.58673)

# Distance from shore
M6 <- rma.uni(data=CH, yi=lnRR, vi=VarLnRR, method="REML", mods=~(shoredist), weighted=TRUE)          # * R2 = 9.09%
M6log <- rma.uni(data=CH, yi=lnRR, vi=VarLnRR, method="REML", mods=~log(shoredist+1), weighted=TRUE)  # NS R2 = 0.17%
AIC.rma(M5,M5log) # log slightly better (no-log=87.20995, log=86.58673)

# Net primary production
M7 <- rma.uni(data=CH, yi=lnRR, vi=VarLnRR, method="REML", mods=~(nppsurf), weighted=TRUE)        # *** R2 = 67.00%
M7log <- rma.uni(data=CH, yi=lnRR, vi=VarLnRR, method="REML", mods=~log(nppsurf), weighted=TRUE)  # *** R2 = 30.64%
AIC.rma(M7,M7log) # log better (no-log=40.93678, log=45.23666z)

# Bottom Phosphorus
M8 <- rma.uni(data=CH, yi=lnRR, vi=VarLnRR, method="REML", mods=~(phosbot), weighted=TRUE)        # NS R2 = 0.00%
M8log <- rma.uni(data=CH, yi=lnRR, vi=VarLnRR, method="REML", mods=~log(phosbot), weighted=TRUE)  # NS  R2 = 0.00%
AIC.rma(M8,M8log) # no-log better (no-log=102.4839, log=103.2023)

# Bottom Nitrate
M9 <- rma.uni(data=CH, yi=lnRR, vi=VarLnRR, method="REML", mods=~(nitbot), weighted=TRUE)        # NS R2 = 0%
M9log <- rma.uni(data=CH, yi=lnRR, vi=VarLnRR, method="REML", mods=~log(nitbot), weighted=TRUE)  # * R2 = 7.35%
AIC.rma(M9,M9log) # log better (no-log=102.0495	, log=99.5358)

# Visualize data
par(mfrow = c(3,3))
regplot(M1log, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0)
regplot(M2log, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0)
regplot(M3, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0)
regplot(M4, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0)
regplot(M5log, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0)
regplot(M6log, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0)
regplot(M7log, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0)
regplot(M8, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0)
regplot(M9log, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0)
```

####2) Chl-a Trawling and recovery 
 - After visual inspection, analysis of p-values and R2 values and theoretical consideration (would it make sense in the real world)
      - log(cvel), log(silbot), log(silbot),  timetrawldays, nppsurf , log(nitbot), seem the most promising. Interactions with timetrawldays can be investigated for recovery effect.
 
```{r, fig.width =8, fig.height = 8, warning=FALSE}
# Current Velocity 
M1 <- rma.uni(data=CHrec, yi=lnRR, vi=VarLnRR, method="REML", mods=~(cvel), weighted=TRUE)       # NS R2 = 0.12%, 
M1log <- rma.uni(data=CHrec, yi=lnRR, vi=VarLnRR, method="REML", mods=~log(cvel), weighted=TRUE) # * R2 = 7.80%
AIC.rma(M1,M1log) # log better (no-log=154.7071	, log=150.7852)

# Bottom Silica
M2 <- rma.uni(data=CHrec, yi=lnRR, vi=VarLnRR, method="REML", mods=~(silbot), weighted=TRUE)       # NS R2 = 0.00%
M2log <- rma.uni(data=CHrec, yi=lnRR, vi=VarLnRR, method="REML", mods=~log(silbot), weighted=TRUE) # NS R2 = 0.75%
AIC.rma(M2,M2log) # log slightly better (no-log=155.2678, log=153.9532)

# Bottom Salinity
M3 <- rma.uni(data=CHrec, yi=lnRR, vi=VarLnRR, method="REML", mods=~(salbot), weighted=TRUE)       # . R2 = 2.19%
M3log <- rma.uni(data=CHrec, yi=lnRR, vi=VarLnRR, method="REML", mods=~log(salbot), weighted=TRUE) # NS R2 = 0.00%
AIC.rma(M3,M3log) # no-log better (no-log=151.7854, log=154.4363)

# Water Depth
M4 <- rma.uni(data=CHrec, yi=lnRR, vi=VarLnRR, method="REML", mods=~(watdepth), weighted=TRUE)       # . R2 = 0.00%
M4log <- rma.uni(data=CHrec, yi=lnRR, vi=VarLnRR, method="REML", mods=~log(watdepth), weighted=TRUE) # NS R2 = 0.00%
AIC.rma(M4,M4log) # no-log better (no-log=156.2589, log=157.9681)

# Time since trawling (for immediate trawling this is between 0-1 days)
M5 <- rma.uni(data=CHrec, yi=lnRR, vi=VarLnRR, method="REML", mods=~(timetrawldays), weighted=TRUE)          # *** R2 = 12.52%
M5log <- rma.uni(data=CHrec, yi=lnRR, vi=VarLnRR, method="REML", mods=~log(timetrawldays+1), weighted=TRUE)  # ** R2 = 5.88%
AIC.rma(M5,M5log) # no-log better (no-log=147.3794, log=152.3167)

# Distance from shore
M6 <- rma.uni(data=CHrec, yi=lnRR, vi=VarLnRR, method="REML", mods=~(shoredist), weighted=TRUE)          # * R2 = 5.31%
M6log <- rma.uni(data=CHrec, yi=lnRR, vi=VarLnRR, method="REML", mods=~log(shoredist+1), weighted=TRUE)  # NS R2 = 0%
AIC.rma(M6,M6log) # no log better (no-log=149.8597, log=155.1524)

# Net primary production
M7 <- rma.uni(data=CHrec, yi=lnRR, vi=VarLnRR, method="REML", mods=~(nppsurf), weighted=TRUE)        # * R2 = 6.09%
M7log <- rma.uni(data=CHrec, yi=lnRR, vi=VarLnRR, method="REML", mods=~log(nppsurf), weighted=TRUE)  # . R2 = 2.70%
AIC.rma(M7,M7log) # no-log better (no-log=150.1063, log=152.4821)

# Bottom Phosphorus
M8 <- rma.uni(data=CHrec, yi=lnRR, vi=VarLnRR, method="REML", mods=~(phosbot), weighted=TRUE)        # NS R2 = 0%
M8log <- rma.uni(data=CHrec, yi=lnRR, vi=VarLnRR, method="REML", mods=~log(phosbot), weighted=TRUE)  # NS  R2 = 0%
AIC.rma(M8,M8log) # no-log slightly better (no-log=155.0769, log=155.2541)

# Bottom Nitrate
M9 <- rma.uni(data=CHrec, yi=lnRR, vi=VarLnRR, method="REML", mods=~(nitbot), weighted=TRUE)        # ** R2 = 6.25%
M9log <- rma.uni(data=CHrec, yi=lnRR, vi=VarLnRR, method="REML", mods=~log(nitbot), weighted=TRUE)  # *** R2 = 14.52%
AIC.rma(M9,M9log) # log better (no-log=147.7321, log=143.3941)

# Visualize data
par(mfrow = c(3,3))
regplot(M1log, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0)
regplot(M2log, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0)
regplot(M3, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0)
regplot(M4, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0)
regplot(M5log, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0)
regplot(M6log, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0)
regplot(M7log, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0)
regplot(M8, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0)
regplot(M9log, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0)
```

####3) Chl-a Comprehensive data 
 - After visual inspection, analysis of p-values and R2 values and theoretical consideration (would it make sense in the real world)
      - log(cvel), log(silbot), nppsurf, log(nitbot) seem the most promising.
      
```{r, fig.width =8, fig.height = 8, warning=FALSE}
# Current Velocity 
M1 <- rma.uni(data=CHAll, yi=lnRR, vi=VarLnRR, method="REML", mods=~(cvel), weighted=TRUE)       # NS R2 = 0.14%, 
M1log <- rma.uni(data=CHAll, yi=lnRR, vi=VarLnRR, method="REML", mods=~log(cvel), weighted=TRUE) # * R2 = 7.80%
AIC.rma(M1,M1log) # log better (no-log=157.0933	, log=150.7852)

# Bottom Silica
M2 <- rma.uni(data=CHAll, yi=lnRR, vi=VarLnRR, method="REML", mods=~(silbot), weighted=TRUE)       # NS R2 = 0.00%
M2log <- rma.uni(data=CHAll, yi=lnRR, vi=VarLnRR, method="REML", mods=~log(silbot), weighted=TRUE) # NS R2 = 0.10%
AIC.rma(M2,M2log) # log better (no-log=157.8156, log=156.7957)

# Bottom Salinity
M3 <- rma.uni(data=CHAll, yi=lnRR, vi=VarLnRR, method="REML", mods=~(salbot), weighted=TRUE)       # * R2 = 2.37%
M3log <- rma.uni(data=CHAll, yi=lnRR, vi=VarLnRR, method="REML", mods=~log(salbot), weighted=TRUE) # NS R2 = 0.00%
AIC.rma(M3,M3log) # log better (no-log=153.9815, log=156.7957)

# Water Depth
M4 <- rma.uni(data=CHAll, yi=lnRR, vi=VarLnRR, method="REML", mods=~(watdepth), weighted=TRUE)       # . R2 = 1.11%
M4log <- rma.uni(data=CHAll, yi=lnRR, vi=VarLnRR, method="REML", mods=~log(watdepth), weighted=TRUE) # NS R2 = 0.00%
AIC.rma(M4,M4log) # no-log better (no-log=158.7754, log=160.6359)

# Time since trawling (for immediate trawling this is between 0-1 days)
#M5 <- rma.uni(data=CHAll, yi=lnRR, vi=VarLnRR, method="REML", mods=~(timetrawldays), weighted=TRUE)          # error
#M5log <- rma.uni(data=CHAll, yi=lnRR, vi=VarLnRR, method="REML", mods=~log(timetrawldays+1), weighted=TRUE)  # error
#AIC.rma(M5,M5log) # cannot log (or do anything else with this variable) 

# Distance from shore
M6 <- rma.uni(data=CHAll, yi=lnRR, vi=VarLnRR, method="REML", mods=~(shoredist), weighted=TRUE)          # . R2 = 1.34%
M6log <- rma.uni(data=CHAll, yi=lnRR, vi=VarLnRR, method="REML", mods=~log(shoredist+1), weighted=TRUE)  # NS R2 = 0%
AIC.rma(M6,M6log) # no log better (no-log=155.2764, log=157.5239)

# Net primary production
M7 <- rma.uni(data=CHAll, yi=lnRR, vi=VarLnRR, method="REML", mods=~(nppsurf), weighted=TRUE)        # * R2 = 6.50%
M7log <- rma.uni(data=CHAll, yi=lnRR, vi=VarLnRR, method="REML", mods=~log(nppsurf), weighted=TRUE)  # . R2 = 3.48%
AIC.rma(M7,M7log) # no-log better (no-log=152.1561, log=154.2690)

# Bottom Phosphorus
M8 <- rma.uni(data=CHAll, yi=lnRR, vi=VarLnRR, method="REML", mods=~(phosbot), weighted=TRUE)        # NS R2 = 0.45%
M8log <- rma.uni(data=CHAll, yi=lnRR, vi=VarLnRR, method="REML", mods=~log(phosbot), weighted=TRUE)  # NS  R2 = 0%
AIC.rma(M8,M8log) # no-log better (no-log=156.3920, log=157.1284)

# Bottom Nitrate
M9 <- rma.uni(data=CHAll, yi=lnRR, vi=VarLnRR, method="REML", mods=~(nitbot), weighted=TRUE)        # ** R2 = 5.74%
M9log <- rma.uni(data=CHAll, yi=lnRR, vi=VarLnRR, method="REML", mods=~log(nitbot), weighted=TRUE)  # *** R2 = 14.45%
AIC.rma(M9,M9log) # log better (no-log=150.5105, log=145.6615)

# Visualize data
par(mfrow = c(3,3))
regplot(M1log, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0)
regplot(M2log, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0)
regplot(M3, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0)
regplot(M4, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0)
#regplot(M5log, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0)
regplot(M6log, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0)
regplot(M7log, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0)
regplot(M8, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0)
regplot(M9log, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0)
```

Investigating quadratic term for Chl-a and current velocity
 - It explains the data well but does not make sense theoretically for higher cvel values (higher current velocities not likely to have higher trawl effects)
 - These results might be interesting for discussion but I don't think they are realistic (I would not extrapolate from this)
 
```{r, warning=FALSE}
Model1 <- rma.uni(data=CH, yi=lnRR, vi=VarLnRR, method="REML", mods=~ cvel + I(cvel^2), weighted=TRUE) # ***, R2=45.85%
xs     <- seq(0, 0.14, length = 65)
tmp <- predict(Model1, newmods = cbind(xs, xs^2))
regplot(Model1, mod = "cvel", pred = tmp, bg = adjustcolor("red", 0.5), shade = adjustcolor("black", 0.3), grid = T, refline = 0, xvals = xs)
```


# FULL MODEL SELECTION

## TOC immediate impact

- Best model: ln(current velocity) + slice depth 
- R2 = 74.82 % when fitted with REML (Restricted Maximum Likelihood)
- R2 = 86.59 % when fitted with DL (DerSimonian-Laird estimator)

```{r}
# start with full model and ML
FullModel <- rma.uni(data=OC, yi=lnRR, vi=VarLnRR, method="ML", weighted=TRUE,
            mods= ~ log(cvel) + silbot + watdepth + log(shoredist+1) + log(nppsurf) + log(phosbot) + log(nitbot) + tempbot + slicedepth + hhabtype + hseason ) # 

# Inspect interactions
m1 <- update.rma(FullModel, ~ . - log(cvel):slicedepth)
m2 <- update.rma(FullModel, ~ . - log(cvel):hhabtype)
m3 <- update.rma(FullModel, ~ . - log(cvel):hseason)
m4 <- update.rma(FullModel, ~ . - log(cvel):log(silbot))
m5 <- update.rma(FullModel, ~ . - log(silbot):slicedepth)
m6 <- update.rma(FullModel, ~ . - log(cvel):hhabtype)
m7 <- update.rma(FullModel, ~ . - log(cvel):hseason)

# Drop interactions and refit
Full2 <- rma.uni(data=OC, yi=lnRR, vi=VarLnRR, method="ML", weighted=TRUE,
            mods= ~ log(cvel) + log(silbot) + slicedepth + hhabtype + hseason)                 
m8 <- update.rma(Full2, ~ . - hseason)    # drop seasonality
m9 <- update.rma(m8, ~ . - hhabtype)      # drop habitat type
m10 <- update.rma(m9, ~ . - log(silbot))  # drop log(bottom silica), all significant

# new stuff
m1 <- update.rma(FullModel, ~ . - log(cvel))    # drop log(cvel)
m2 <- update.rma(m1, ~ . - silbot)              # drop silbot
m3 <- update.rma(m2, ~ . - log(nitbot))         # drop log(nitbot)
m4 <- update.rma(m3, ~ . - hseason)             # drop (all significant)
m5 <- update.rma(m4, ~ . - hhabtype)            # drop hhabtype
m6 <- update.rma(m5, ~ . - log(shoredist + 1))  # drop log(shoredist + 1)
m7 <- update.rma(m6, ~ . - watdepth)            # drop watdepth from collinearity

# Best model for OC immediate
# Refit with REML
BestMod <- rma.uni(data=OC, yi=lnRR, vi=VarLnRR, method="REML", weighted=TRUE,
            mods= ~ log(nppsurf) + log(phosbot) + tempbot + slicedepth) #
vif.rma(BestMod)
```

## TOC trawling + recovery

- Best model: ln(current velocity) + ln(days since trawling + 1) + slice depth + ln(current velocity):ln(days since trawling + 1)
- R2 = 70.71 % when fitted with REML (Restricted Maximum Likelihood)
- R2 = 81.26% % when fitted with DL (DerSimonian-Laird estimator)

```{r}
# start with full model and ML
FullModel <- rma.uni(data=OCrec, yi=lnRR, vi=VarLnRR, method="ML", weighted=TRUE,
            mods= ~ log(cvel) * log(silbot) * log(timetrawldays+1) * hhabtype * hseason * slicedepth)

# inspect interactions
m1 <- update.rma(FullModel, ~ . - log(cvel):log(silbot):hseason)                # drop 3 way interaction
m2 <- update.rma(FullModel, ~ . - log(cvel):log(timetrawldays + 1):log(silbot)) # drop 3 way interaction
m3 <- update.rma(FullModel, ~ . - log(cvel):log(timetrawldays + 1))             # drop velocity:time since trawl
m4 <- update.rma(FullModel, ~ . - log(cvel):slicedepth)                         # drop velocity:depth slice

# drop non-significant interactions and refit
m5 <- rma.uni(data=OCrec, yi=lnRR, vi=VarLnRR, method="ML", weighted=TRUE,
            mods= ~ log(cvel) + log(timetrawldays+1) + log(silbot) + slicedepth + 
            log(timetrawldays + 1):slicedepth +
            log(cvel):log(timetrawldays+1) )               
m6 <- update.rma(m5, ~ . - log(timetrawldays + 1):slicedepth) # drop time since trawl:depth.slice
m7 <- update.rma(m6, ~ . - log(silbot))                       # drop log(silbot), all significant 

# Best model for OC trawl + recovery
# Refit with REML
BestMod <- rma.uni(data=OCrec, yi=lnRR, vi=VarLnRR, method="REML", weighted=TRUE,
            mods= ~ log(cvel) + log(timetrawldays+1) + slicedepth + log(cvel):log(timetrawldays+1)) 

BestMod <- rma.uni(data=OCrec, yi=lnRR, vi=VarLnRR, method="REML", weighted=TRUE,
            mods= ~ log(cvel) + log(timetrawldays+1) + slicedepth + log(cvel):log(timetrawldays+1)) 
```

## TOC comprehensive

- Best model has: ln(bottom silicate) + slice depth
- R2 = 41.01 % when fitted with REML (Restricted Maximum Likelihood)
- R2 = 39.80% % when fitted with DL (DerSimonian-Laird estimator)

```{r}
# start with full model and ML
FullModel <- rma.uni(data=OCAll, yi=lnRR, vi=VarLnRR, method="ML", weighted=TRUE,
            mods= ~ log(cvel) * log(silbot) * hhabtype * hseason * slicedepth)

# inspect interactions
m1 <- update.rma(FullModel, ~ . - log(cvel):log(silbot):hseason)                # drop 3 way interaction
m2 <- update.rma(FullModel, ~ . - log(cvel):log(timetrawldays + 1):log(silbot)) # drop 3 way interaction
m3 <- update.rma(FullModel, ~ . - log(cvel):log(timetrawldays + 1))             # drop velocity:time since trawl
m4 <- update.rma(FullModel, ~ . - log(cvel):slicedepth)                         # drop velocity:depth slice

# drop non-significant interactions and refit (automatically drops certain variables)
m5 <- rma.uni(data=OCAll, yi=lnRR, vi=VarLnRR, method="ML", weighted=TRUE,
            mods= ~ log(cvel) + log(silbot) + slicedepth + hseason + 
                    hseason:slicedepth + log(silbot):hseason + log(cvel):hseason + log(silbot):hhabtype)               
m6 <- update.rma(m5, ~ . - log(silbot):hhabtype) # drop log(silbot):hhabtype
m7 <- update.rma(m6, ~ . - log(cvel):hseason)    # drop log(cvel):hseason
m8 <- update.rma(m7, ~ . - log(silbot):hseason)  # drop log(silbot):hseason
m9 <- update.rma(m8, ~ . - slicedepth:hseason)   # drop log(silbot):hseason
m10 <- update.rma(m9, ~ . - hseason)             # drop hseason
m11 <- update.rma(m10, ~ . - log(cvel))          # drop log(cvel), all significant

# Best model for TOC comprehensive
# Refit with REML
BestMod <- rma.uni(data=OCAll, yi=lnRR, vi=VarLnRR, method="REML", weighted=TRUE,
            mods= ~ log(silbot) + slicedepth)               
```

## Chl-a immediate impact

- Best model: ln(Net primary production) + ln(bottom silicate) + slice depth
- R2 = 61.35 % when fitted with REML (Restricted Maximum Likelihood)
- R2 = 49.16 % when fitted with DL (DerSimonian-Laird estimator)

```{r}
# start with full model and ML
FullModel <- rma.uni(data=CH, yi=lnRR, vi=VarLnRR, method="ML", weighted=TRUE, 
            mods= ~ log(cvel) * log(nppsurf) * log(silbot) * log(nitbot)* watdepth * slicedepth * hhabtype * hseason)#

# inspect interactions, drop one by one
m1 <- update.rma(FullModel, ~ . - log(cvel):log(silbot))
m2 <- update.rma(m1, ~ . - log(nppsurf):watdepth)       
m3 <- update.rma(m2, ~ . - log(silbot):watdepth)        
m4 <- update.rma(m3, ~ . - log(cvel):log(nppsurf))                      
m5 <- update.rma(m4, ~ . - log(silbot):log(nitbot))                      
m6 <- update.rma(m5, ~ . - watdepth:slicedepth)                      
m7 <- update.rma(m6, ~ . - log(nppsurf):slicedepth)                      
m8 <- update.rma(m7, ~ . - log(silbot):slicedepth)                      
m9 <- update.rma(m8, ~ . - log(nitbot):slicedepth)                      
m10 <- update.rma(m9, ~ . - log(silbot):hhabtype)     
m11 <- update.rma(m10, ~ . - log(cvel):hhabtype)                      
m12 <- update.rma(m11, ~ . - log(nitbot):hhabtype)
m13 <- update.rma(m12, ~ . - watdepth:hhabtype)                      
m14 <- update.rma(m13, ~ . - watdepth:hhabtype)                      

# drop interactions and refit
Full2 <- rma.uni(data=CH, yi=lnRR, vi=VarLnRR, method="ML", weighted=TRUE, 
            mods= ~ log(cvel) + log(nppsurf) + log(silbot) + log(nitbot) + watdepth + slicedepth + hhabtype + hseason)#     
m1 <- update.rma(Full2, ~ . - hseason) # drop hseason              
m2 <- update.rma(m1, ~ . - log(nitbot))# drop log(nitbot)             
m3 <- update.rma(m2, ~ . - watdepth)   # drop watdepth               
m4 <- update.rma(m3, ~ . - hhabtype)   # drop htype              
m5 <- update.rma(m4, ~ . - log(cvel))  # drop log(cvel), all significant              
m6 <- update.rma(m5, ~ . - log(silbot))# drop log(silbot) if needed (vif = 4.9)              
vif.rma(m5)

# Best model for Chl-a immediate effect
# Refit with REML
BestMod <- rma.uni(data=CH, yi=lnRR, vi=VarLnRR, method="REML", weighted=TRUE, 
            mods= ~ log(nppsurf) + log(silbot) + slicedepth)# 
```

## Chl-a trawling + recovery

- Best model: ln(current velocity) + ln(net primary production) + ln(bottom silicate) + ln(days since trawling +1) + sample depth slice + habitat type
- R2 = 51.69 % when fitted with REML (Restricted Maximum Likelihood)
- R2 = 37.19 % when fitted with DL (DerSimonian-Laird estimator)

```{r}
# start with full model and ML
FullModel <- rma.uni(data=CHrec, yi=lnRR, vi=VarLnRR, method="ML", weighted=TRUE, 
            mods= ~ log(cvel) * log(nppsurf) * log(silbot) * log(nitbot)* watdepth * log(timetrawldays+1) * slicedepth * hhabtype)#

# inspect interactions, drop one by one
m1 <- update.rma(FullModel, ~ . - log(cvel):log(timetrawldays + 1))
m2 <- update.rma(m1, ~ . - watdepth:log(timetrawldays + 1))       
m3 <- update.rma(m2, ~ . - log(nppsurf):log(nitbot))        
m4 <- update.rma(m3, ~ . - log(cvel):log(nppsurf):log(timetrawldays + 1))                      
m5 <- update.rma(m4, ~ . - log(nppsurf):log(nitbot):log(timetrawldays + 1)	)                      
m6 <- update.rma(m5, ~ . - log(silbot):log(nitbot):log(timetrawldays + 1)	)                      
m7 <- update.rma(m6, ~ . - log(cvel):watdepth:log(timetrawldays + 1)	)                      
m8 <- update.rma(m7, ~ . - log(cvel):slicedepth)                      
m9 <- update.rma(m8, ~ . - log(nppsurf):slicedepth)                      
m10 <- update.rma(m9, ~ . - log(cvel):watdepth:log(timetrawldays + 1))     
m11 <- update.rma(m10, ~ . - log(timetrawldays + 1):slicedepth)                      
m12 <- update.rma(m11, ~ . - log(cvel):log(nppsurf):log(timetrawldays + 1))
m13 <- update.rma(m12, ~ . - log(nppsurf):log(timetrawldays + 1))                      
m14 <- update.rma(m13, ~ . - log(nppsurf):log(nitbot))                      

# drop interactions and refit
Full2 <- rma.uni(data=CHrec, yi=lnRR, vi=VarLnRR, method="ML", weighted=TRUE, 
            mods= ~ log(cvel) + log(nppsurf) + log(silbot) + log(nitbot) + watdepth + log(timetrawldays+1) + slicedepth + hhabtype)#

m1 <- update.rma(Full2, ~ . - log(nitbot)) # drop log(nitbot)              
m2 <- update.rma(m1, ~ . - watdepth	)      # drop watdepth, all significant

# Best model for Chl-a trawling + recovery
# Refit with REML
BestMod <- rma.uni(data=CHrec, yi=lnRR, vi=VarLnRR, method="REML", weighted=TRUE, 
            mods= ~ log(cvel) + log(nppsurf) + log(silbot) + log(timetrawldays+1) + slicedepth + hhabtype)#
```

## Chl-a comprehensive

- Best model: ln(current velocity) + ln(net primary production) + ln(bottom silicate) + sample depth + habitat type
- R2 = 47.93 % when fitted with REML (Restricted Maximum Likelihood)
- R2 = 32.47 % when fitted with DL (DerSimonian-Laird estimator)

```{r}
# start with full model and ML
FullModel <- rma.uni(data=CHAll, yi=lnRR, vi=VarLnRR, method="ML", weighted=TRUE, 
            mods= ~ log(cvel) * log(nppsurf) * log(silbot) * log(nitbot)* watdepth * slicedepth * hhabtype)#

# inspect interactions, drop one by one
m1 <- update.rma(FullModel, ~ . - log(nppsurf):log(silbot))
m2 <- update.rma(m1, ~ . - log(nitbot):watdepth)       
m3 <- update.rma(m2, ~ . - log(nppsurf):log(nitbot))        
m4 <- update.rma(m3, ~ . - log(nppsurf):slicedepth)                      
m5 <- update.rma(m4, ~ . - log(silbot):slicedepth)                      
m6 <- update.rma(m5, ~ . - log(nitbot):slicedepth	)                      
m7 <- update.rma(m6, ~ . - log(cvel):hhabtype)                      
m8 <- update.rma(m7, ~ . - log(silbot):hhabtype)                      
m9 <- update.rma(m8, ~ . - watdepth:slicedepth)                      
m10 <- update.rma(m9, ~ . - log(nppsurf):hhabtype)     
m11 <- update.rma(m10, ~ . - log(nitbot):hhabtype)                      
m12 <- update.rma(m11, ~ . - watdepth:hhabtype)
m13 <- update.rma(m12, ~ . - slicedepth:hhabtype)                      
m14 <- update.rma(m13, ~ . - log(cvel):log(nppsurf):log(silbot))                      

# drop interactions and refit
Full2 <- rma.uni(data=CHrec, yi=lnRR, vi=VarLnRR, method="ML", weighted=TRUE, 
            mods= ~ log(cvel) + log(nppsurf) + log(silbot) + log(nitbot) + watdepth + slicedepth + hhabtype)#

m1 <- update.rma(Full2, ~ . - watdepth)    # drop watdepth              
m2 <- update.rma(m1, ~ . - log(nitbot))  # drop log(nitbot), all significant

# Best model for Chl-a comprehensive
# Refit with REML
BestMod <- rma.uni(data=CHAll, yi=lnRR, vi=VarLnRR, method="REML", weighted=TRUE, 
            mods= ~ log(cvel) + log(nppsurf) + log(silbot) + slicedepth + hhabtype)#
```